=== RUN   TestGetEnvOrDefault
=== RUN   TestGetEnvOrDefault/env_value_exists
=== RUN   TestGetEnvOrDefault/env_value_empty_returns_default
=== RUN   TestGetEnvOrDefault/nonexistent_key_returns_default
--- PASS: TestGetEnvOrDefault (0.00s)
    --- PASS: TestGetEnvOrDefault/env_value_exists (0.00s)
    --- PASS: TestGetEnvOrDefault/env_value_empty_returns_default (0.00s)
    --- PASS: TestGetEnvOrDefault/nonexistent_key_returns_default (0.00s)
=== RUN   TestGetEnvIntOrDefault
=== RUN   TestGetEnvIntOrDefault/valid_integer
=== RUN   TestGetEnvIntOrDefault/invalid_integer_returns_default
=== RUN   TestGetEnvIntOrDefault/empty_value_returns_default
--- PASS: TestGetEnvIntOrDefault (0.00s)
    --- PASS: TestGetEnvIntOrDefault/valid_integer (0.00s)
    --- PASS: TestGetEnvIntOrDefault/invalid_integer_returns_default (0.00s)
    --- PASS: TestGetEnvIntOrDefault/empty_value_returns_default (0.00s)
=== RUN   TestHasChanged
=== RUN   TestHasChanged/no_change
=== RUN   TestHasChanged/value_changed
=== RUN   TestHasChanged/new_key_added
=== RUN   TestHasChanged/key_removed
--- PASS: TestHasChanged (0.00s)
    --- PASS: TestHasChanged/no_change (0.00s)
    --- PASS: TestHasChanged/value_changed (0.00s)
    --- PASS: TestHasChanged/new_key_added (0.00s)
    --- PASS: TestHasChanged/key_removed (0.00s)
=== RUN   TestFormatChangeMessage
=== RUN   TestFormatChangeMessage/turn_on
=== RUN   TestFormatChangeMessage/turn_off
=== RUN   TestFormatChangeMessage/contact_sensor_opened
=== RUN   TestFormatChangeMessage/contact_sensor_closed
=== RUN   TestFormatChangeMessage/motion_detected
=== RUN   TestFormatChangeMessage/motion_cleared
=== RUN   TestFormatChangeMessage/brightness_change
=== RUN   TestFormatChangeMessage/temperature_change
=== RUN   TestFormatChangeMessage/humidity_change
=== RUN   TestFormatChangeMessage/battery_level_change
=== RUN   TestFormatChangeMessage/low_battery_warning
=== RUN   TestFormatChangeMessage/battery_ok
=== RUN   TestFormatChangeMessage/unknown_key
--- PASS: TestFormatChangeMessage (0.00s)
    --- PASS: TestFormatChangeMessage/turn_on (0.00s)
    --- PASS: TestFormatChangeMessage/turn_off (0.00s)
    --- PASS: TestFormatChangeMessage/contact_sensor_opened (0.00s)
    --- PASS: TestFormatChangeMessage/contact_sensor_closed (0.00s)
    --- PASS: TestFormatChangeMessage/motion_detected (0.00s)
    --- PASS: TestFormatChangeMessage/motion_cleared (0.00s)
    --- PASS: TestFormatChangeMessage/brightness_change (0.00s)
    --- PASS: TestFormatChangeMessage/temperature_change (0.00s)
    --- PASS: TestFormatChangeMessage/humidity_change (0.00s)
    --- PASS: TestFormatChangeMessage/battery_level_change (0.00s)
    --- PASS: TestFormatChangeMessage/low_battery_warning (0.00s)
    --- PASS: TestFormatChangeMessage/battery_ok (0.00s)
    --- PASS: TestFormatChangeMessage/unknown_key (0.00s)
=== RUN   TestFetchAccessories
=== RUN   TestFetchAccessories/successful_fetch
=== RUN   TestFetchAccessories/401_with_successful_noauth
Obtained auth token via /api/auth/noauth, retrying...
=== RUN   TestFetchAccessories/server_error
--- PASS: TestFetchAccessories (0.00s)
    --- PASS: TestFetchAccessories/successful_fetch (0.00s)
    --- PASS: TestFetchAccessories/401_with_successful_noauth (0.00s)
    --- PASS: TestFetchAccessories/server_error (0.00s)
=== RUN   TestGetAccessoryName
=== RUN   TestGetAccessoryName/valid_name_found
=== RUN   TestGetAccessoryName/no_name_characteristic
=== RUN   TestGetAccessoryName/name_not_string
--- PASS: TestGetAccessoryName (0.00s)
    --- PASS: TestGetAccessoryName/valid_name_found (0.00s)
    --- PASS: TestGetAccessoryName/no_name_characteristic (0.00s)
    --- PASS: TestGetAccessoryName/name_not_string (0.00s)
=== RUN   TestIsKnownChildBridge
=== RUN   TestIsKnownChildBridge/main_bridge_excluded
=== RUN   TestIsKnownChildBridge/child_bridge_included
=== RUN   TestIsKnownChildBridge/another_child_bridge_included
--- PASS: TestIsKnownChildBridge (0.00s)
    --- PASS: TestIsKnownChildBridge/main_bridge_excluded (0.00s)
    --- PASS: TestIsKnownChildBridge/child_bridge_included (0.00s)
    --- PASS: TestIsKnownChildBridge/another_child_bridge_included (0.00s)
=== RUN   TestAccessoryStatusDeepEqual
--- PASS: TestAccessoryStatusDeepEqual (0.00s)
=== RUN   TestReportChange

[14:59:10] Test Light:
  turned ON
  brightness: 50% → 75%

[14:59:10] Test Light:
  turned ON
  Brightness: 50 → (removed)

[14:59:10] Test Light:
  Hue: (new) 180
--- PASS: TestReportChange (0.00s)
=== RUN   TestHasHAPAccessories
=== RUN   TestHasHAPAccessories/has_accessories
=== RUN   TestHasHAPAccessories/no_accessories
=== RUN   TestHasHAPAccessories/http_error
=== RUN   TestHasHAPAccessories/non-200_status
--- PASS: TestHasHAPAccessories (0.01s)
    --- PASS: TestHasHAPAccessories/has_accessories (0.00s)
    --- PASS: TestHasHAPAccessories/no_accessories (0.00s)
    --- PASS: TestHasHAPAccessories/http_error (0.00s)
    --- PASS: TestHasHAPAccessories/non-200_status (0.00s)
=== RUN   TestGetNoAuthTokenComplete
=== RUN   TestGetNoAuthTokenComplete/token_field
=== RUN   TestGetNoAuthTokenComplete/no_token_in_response
=== RUN   TestGetNoAuthTokenComplete/invalid_json
--- PASS: TestGetNoAuthTokenComplete (0.00s)
    --- PASS: TestGetNoAuthTokenComplete/token_field (0.00s)
    --- PASS: TestGetNoAuthTokenComplete/no_token_in_response (0.00s)
    --- PASS: TestGetNoAuthTokenComplete/invalid_json (0.00s)
=== RUN   TestDebugf
=== RUN   TestDebugf/debug_enabled
[DEBUG] test message hello 42=== RUN   TestDebugf/debug_disabled
--- PASS: TestDebugf (0.00s)
    --- PASS: TestDebugf/debug_enabled (0.00s)
    --- PASS: TestDebugf/debug_disabled (0.00s)
=== RUN   TestMonitorRun
=== RUN   TestMonitorRun/single_check

[14:59:10] Checking 0 accessories...
New accessory detected: Test Light
Summary: 0 changes, 1 new accessories
=== RUN   TestMonitorRun/multiple_checks

[14:59:10] Checking 0 accessories...
New accessory detected: Test Light
Summary: 0 changes, 1 new accessories

[14:59:10] Checking 1 accessories...

[14:59:10] Test Light:
  turned ON
Summary: 1 changes, 0 new accessories

[14:59:10] Checking 1 accessories...

[14:59:10] Test Light:
  turned OFF
Summary: 1 changes, 0 new accessories
Completed 3 checks, exiting.
--- PASS: TestMonitorRun (0.10s)
    --- PASS: TestMonitorRun/single_check (0.00s)
    --- PASS: TestMonitorRun/multiple_checks (0.10s)
=== RUN   TestCheckStatus
=== RUN   TestCheckStatus/successful_check_with_changes

[14:59:10] Checking 1 accessories...

[14:59:10] Test Light:
  turned ON
Summary: 1 changes, 0 new accessories
=== RUN   TestCheckStatus/error_during_fetch

[14:59:10] Checking 0 accessories...
2025/07/13 14:59:10 Error fetching accessories: failed to fetch accessories: Get "http://nonexistent.invalid/api/accessories": dial tcp: lookup nonexistent.invalid: no such host
--- PASS: TestCheckStatus (0.00s)
    --- PASS: TestCheckStatus/successful_check_with_changes (0.00s)
    --- PASS: TestCheckStatus/error_during_fetch (0.00s)
=== RUN   TestGetChildBridges
=== RUN   TestGetChildBridges/successful_response
=== RUN   TestGetChildBridges/auth_failure
Failed to parse token response: unexpected end of JSON input
--- PASS: TestGetChildBridges (0.00s)
    --- PASS: TestGetChildBridges/successful_response (0.00s)
    --- PASS: TestGetChildBridges/auth_failure (0.00s)
=== RUN   TestProcessAccessories
--- PASS: TestProcessAccessories (0.00s)
=== RUN   TestGenerateSummaryLine
=== RUN   TestGenerateSummaryLine/initial_discovery_single_accessory
=== RUN   TestGenerateSummaryLine/initial_discovery_multiple_accessories
=== RUN   TestGenerateSummaryLine/no_changes
=== RUN   TestGenerateSummaryLine/changes_detected
--- PASS: TestGenerateSummaryLine (0.00s)
    --- PASS: TestGenerateSummaryLine/initial_discovery_single_accessory (0.00s)
    --- PASS: TestGenerateSummaryLine/initial_discovery_multiple_accessories (0.00s)
    --- PASS: TestGenerateSummaryLine/no_changes (0.00s)
    --- PASS: TestGenerateSummaryLine/changes_detected (0.00s)
=== RUN   TestFetchHAPResponse
=== RUN   TestFetchHAPResponse/successful_fetch
=== RUN   TestFetchHAPResponse/connection_error
--- PASS: TestFetchHAPResponse (0.00s)
    --- PASS: TestFetchHAPResponse/successful_fetch (0.00s)
    --- PASS: TestFetchHAPResponse/connection_error (0.00s)
=== RUN   TestChildBridgeListsEqual
=== RUN   TestChildBridgeListsEqual/both_empty
=== RUN   TestChildBridgeListsEqual/same_bridges
=== RUN   TestChildBridgeListsEqual/different_order
=== RUN   TestChildBridgeListsEqual/different_length
=== RUN   TestChildBridgeListsEqual/different_bridges
--- PASS: TestChildBridgeListsEqual (0.00s)
    --- PASS: TestChildBridgeListsEqual/both_empty (0.00s)
    --- PASS: TestChildBridgeListsEqual/same_bridges (0.00s)
    --- PASS: TestChildBridgeListsEqual/different_order (0.00s)
    --- PASS: TestChildBridgeListsEqual/different_length (0.00s)
    --- PASS: TestChildBridgeListsEqual/different_bridges (0.00s)
=== RUN   TestTrimServiceName
=== RUN   TestTrimServiceName/removes_last_field
=== RUN   TestTrimServiceName/handles_multiple_words
=== RUN   TestTrimServiceName/single_word_unchanged
--- PASS: TestTrimServiceName (0.00s)
    --- PASS: TestTrimServiceName/removes_last_field (0.00s)
    --- PASS: TestTrimServiceName/handles_multiple_words (0.00s)
    --- PASS: TestTrimServiceName/single_word_unchanged (0.00s)
=== RUN   TestRunFunction

[14:59:10] Checking 0 accessories...
New accessory detected: Test Light
Summary: 0 changes, 1 new accessories
--- PASS: TestRunFunction (0.00s)
=== RUN   TestPerformDiscovery
Failed to get auth token from response: map[message:Unauthorized statusCode:401]

Discovered bridges:
--- PASS: TestPerformDiscovery (0.05s)
=== RUN   TestDisplayDiscoveryResults
--- PASS: TestDisplayDiscoveryResults (0.00s)
=== RUN   TestPrintOutputSync
test line 1
test line 2
--- PASS: TestPrintOutputSync (0.00s)
=== RUN   TestFilterServicesByExpectedNames
--- PASS: TestFilterServicesByExpectedNames (0.00s)
=== RUN   TestDiscoverHAPServicesWithTimeoutAndFilter
    main_test.go:1255: No services found, which is acceptable for network-dependent test
--- PASS: TestDiscoverHAPServicesWithTimeoutAndFilter (1.17s)
=== RUN   TestNewMDNSClient
--- PASS: TestNewMDNSClient (0.00s)
=== RUN   TestParseTXTRecord
=== RUN   TestParseTXTRecord/key-value_pair
=== RUN   TestParseTXTRecord/boolean_flag
=== RUN   TestParseTXTRecord/empty_value
=== RUN   TestParseTXTRecord/multiple_equals
--- PASS: TestParseTXTRecord (0.00s)
    --- PASS: TestParseTXTRecord/key-value_pair (0.00s)
    --- PASS: TestParseTXTRecord/boolean_flag (0.00s)
    --- PASS: TestParseTXTRecord/empty_value (0.00s)
    --- PASS: TestParseTXTRecord/multiple_equals (0.00s)
=== RUN   TestParseTXTRecordMultiple
--- PASS: TestParseTXTRecordMultiple (0.00s)
=== RUN   TestMDNSServiceValidation
--- PASS: TestMDNSServiceValidation (0.00s)
=== RUN   TestMDNSClientTimeout
--- PASS: TestMDNSClientTimeout (0.00s)
=== RUN   TestDiscoverHomebridgeServicesWithMockData
    mdns_test.go:189: Discovery with short timeout returned 0 services
--- PASS: TestDiscoverHomebridgeServicesWithMockData (0.10s)
=== RUN   TestMDNSServiceFiltering
--- PASS: TestMDNSServiceFiltering (0.00s)
=== RUN   TestMDNSServiceValidPort
=== RUN   TestMDNSServiceValidPort/valid_service_with_host_and_port
=== RUN   TestMDNSServiceValidPort/invalid_service_missing_host
=== RUN   TestMDNSServiceValidPort/invalid_service_missing_port
=== RUN   TestMDNSServiceValidPort/invalid_service_missing_both
--- PASS: TestMDNSServiceValidPort (0.00s)
    --- PASS: TestMDNSServiceValidPort/valid_service_with_host_and_port (0.00s)
    --- PASS: TestMDNSServiceValidPort/invalid_service_missing_host (0.00s)
    --- PASS: TestMDNSServiceValidPort/invalid_service_missing_port (0.00s)
    --- PASS: TestMDNSServiceValidPort/invalid_service_missing_both (0.00s)
=== RUN   TestTXTRecordEdgeCases
=== RUN   TestTXTRecordEdgeCases/empty_string
=== RUN   TestTXTRecordEdgeCases/just_equals
=== RUN   TestTXTRecordEdgeCases/key_with_no_value_but_equals
=== RUN   TestTXTRecordEdgeCases/just_key
--- PASS: TestTXTRecordEdgeCases (0.00s)
    --- PASS: TestTXTRecordEdgeCases/empty_string (0.00s)
    --- PASS: TestTXTRecordEdgeCases/just_equals (0.00s)
    --- PASS: TestTXTRecordEdgeCases/key_with_no_value_but_equals (0.00s)
    --- PASS: TestTXTRecordEdgeCases/just_key (0.00s)
=== RUN   TestContextWithMDNS
    mdns_test.go:390: Context test timed out, which is acceptable for network-dependent tests
--- PASS: TestContextWithMDNS (0.30s)
=== RUN   TestMDNSServiceStructComplete
--- PASS: TestMDNSServiceStructComplete (0.00s)
=== RUN   TestLookupServiceErrorHandling
--- PASS: TestLookupServiceErrorHandling (2.06s)
=== RUN   TestParseServiceResponseNilCases
--- PASS: TestParseServiceResponseNilCases (0.00s)
=== RUN   TestParseServiceResponseWithData
=== RUN   TestParseServiceResponseWithData/valid_SRV_and_TXT_records
=== RUN   TestParseServiceResponseWithData/missing_SRV_record
--- PASS: TestParseServiceResponseWithData (0.00s)
    --- PASS: TestParseServiceResponseWithData/valid_SRV_and_TXT_records (0.00s)
    --- PASS: TestParseServiceResponseWithData/missing_SRV_record (0.00s)
=== RUN   TestDiscoverHomebridgeServicesTimeout
    mdns_test.go:584: DiscoverHomebridgeServices() found 0 services
--- PASS: TestDiscoverHomebridgeServicesTimeout (0.10s)
PASS
ok  	homebridge-captains-log	4.106s
